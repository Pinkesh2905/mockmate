{% extends "base.html" %}
{% load static %}

{% block title %}Setup Mock Interview | MockMate{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<style>
  :root {
    --primary-blue: #3b82f6;
    --secondary-blue: #1e40af;
    --accent-blue: #60a5fa;
    --success-green: #4ade80;
    --warning-orange: #f59e0b;
    --danger-red: #ef4444;
    --glass-bg: rgba(255, 255, 255, 0.08);
    --glass-border: rgba(255, 255, 255, 0.1);
    --text-primary: #e2e8f0;
    --text-secondary: #94a3b8;
    --border-color: rgba(148, 163, 184, 0.2);
    --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
    --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
    --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
    --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
  }
  
  .container-main {
    background: var(--glass-bg);
    backdrop-filter: blur(16px);
    border-radius: 16px;
    box-shadow: var(--shadow-xl);
    border: 1px solid var(--glass-border);
    transition: all 0.2s ease;
  }
  
  .container-main:hover {
    background: rgba(255, 255, 255, 0.12);
    border-color: rgba(255, 255, 255, 0.2);
  }
  
  .form-group {
    margin-bottom: 1.5rem;
  }
  
  .form-label {
    display: flex;
    align-items: center;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
    font-size: 0.95rem;
  }
  
  .form-input {
    width: 100%;
    padding: 0.75rem 1rem;
    border: 2px solid var(--border-color);
    border-radius: 8px;
    font-size: 0.95rem;
    transition: all 0.2s ease;
    background: rgba(255, 255, 255, 0.05);
    color: var(--text-primary);
    backdrop-filter: blur(8px);
  }
  
  .form-input::placeholder {
    color: var(--text-secondary);
  }
  
  .form-input:focus {
    border-color: var(--primary-blue);
    outline: none;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
    background: rgba(255, 255, 255, 0.08);
  }
  
  .upload-area {
    border: 2px dashed var(--border-color);
    border-radius: 12px;
    padding: 2rem;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s ease;
    background: rgba(255, 255, 255, 0.03);
    backdrop-filter: blur(8px);
  }
  
  .upload-area:hover {
    border-color: var(--primary-blue);
    background: rgba(59, 130, 246, 0.05);
  }
  
  .upload-area.has-file {
    border-color: var(--success-green);
    background: rgba(74, 222, 128, 0.05);
  }
  
  .btn-primary {
    background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
    color: white;
    padding: 1rem 2rem;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: var(--shadow-md);
  }
  
  .btn-primary:hover {
    transform: translateY(-1px);
    box-shadow: 0 10px 25px -3px rgba(59, 130, 246, 0.4);
  }
  
  .btn-primary:active {
    transform: translateY(0);
  }
  
  .skill-tag {
    display: inline-block;
    background: rgba(59, 130, 246, 0.1);
    color: var(--accent-blue);
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.8rem;
    margin: 0.25rem;
    cursor: pointer;
    transition: all 0.2s ease;
    border: 1px solid rgba(59, 130, 246, 0.2);
  }
  
  .skill-tag:hover {
    background: var(--primary-blue);
    color: white;
    transform: translateY(-1px);
  }
  
  .progress-step {
    display: flex;
    align-items: center;
    flex: 1;
    position: relative;
  }
  
  .progress-step.active .step-circle {
    background: var(--primary-blue);
    color: white;
  }
  
  .progress-step.active .step-label {
    color: var(--primary-blue);
    font-weight: 600;
  }
  
  .step-circle {
    width: 2rem;
    height: 2rem;
    border-radius: 50%;
    background: rgba(148, 163, 184, 0.3);
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 0.875rem;
  }
  
  .step-label {
    margin-left: 0.75rem;
    font-size: 0.875rem;
    color: var(--text-secondary);
  }
  
  .step-connector {
    flex: 1;
    height: 2px;
    background: var(--border-color);
    margin: 0 1rem;
  }
  
  .step-connector.active {
    background: var(--primary-blue);
  }
  
  .icon-container {
    width: 2rem;
    height: 2rem;
    border-radius: 6px;
    background: var(--primary-blue);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 0.75rem;
  }
  
  .feature-card {
    background: var(--glass-bg);
    backdrop-filter: blur(12px);
    border-radius: 12px;
    padding: 1.5rem;
    text-align: center;
    border: 1px solid var(--glass-border);
    transition: all 0.2s ease;
  }
  
  .feature-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
    background: rgba(255, 255, 255, 0.12);
    border-color: rgba(255, 255, 255, 0.2);
  }
  
  .message-alert {
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 1rem;
    display: flex;
    align-items: flex-start;
    backdrop-filter: blur(12px);
  }
  
  .message-alert.success {
    background: rgba(74, 222, 128, 0.1);
    color: var(--success-green);
    border: 1px solid rgba(74, 222, 128, 0.2);
  }
  
  .message-alert.error {
    background: rgba(239, 68, 68, 0.1);
    color: #fca5a5;
    border: 1px solid rgba(239, 68, 68, 0.2);
  }
  
  .message-alert.info {
    background: rgba(59, 130, 246, 0.1);
    color: var(--accent-blue);
    border: 1px solid rgba(59, 130, 246, 0.2);
  }
  
  .radio-option {
    position: relative;
    padding: 0.75rem 1rem;
    border: 2px solid var(--border-color);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(8px);
  }
  
  .radio-option:hover {
    border-color: var(--primary-blue);
    background: rgba(59, 130, 246, 0.05);
  }
  
  .radio-option.active {
    border-color: var(--primary-blue);
    background: rgba(59, 130, 246, 0.1);
  }
  
  .radio-option input[type="radio"] {
    accent-color: var(--primary-blue);
  }
  
  .tips-box {
    padding: 1rem;
    background: rgba(59, 130, 246, 0.05);
    border: 1px solid rgba(59, 130, 246, 0.2);
    border-radius: 8px;
    backdrop-filter: blur(8px);
  }
  
  .tips-box .tips-title {
    color: var(--accent-blue);
    font-weight: 600;
    font-size: 0.875rem;
    margin-bottom: 0.5rem;
  }
  
  .tips-box ul {
    color: rgba(96, 165, 250, 0.9);
    font-size: 0.875rem;
    margin: 0;
    padding-left: 1rem;
  }
  
  .tips-box ul li {
    margin-bottom: 0.25rem;
  }
  
  .security-badge {
    display: flex;
    align-items: center;
    color: var(--text-secondary);
    font-size: 0.875rem;
  }
  
  .security-badge i {
    color: var(--success-green);
    margin-right: 0.5rem;
  }
  
  .optional-badge {
    font-size: 0.75rem;
    background: rgba(148, 163, 184, 0.1);
    color: var(--text-secondary);
    padding: 0.25rem 0.5rem;
    border-radius: 12px;
    margin-left: 0.5rem;
  }
  
  .hero-section {
    text-align: center;
    margin-bottom: 2rem;
  }
  
  .hero-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 4rem;
    height: 4rem;
    background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
    border-radius: 16px;
    margin-bottom: 1rem;
    box-shadow: var(--shadow-lg);
  }
  
  .hero-title {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 0.75rem;
  }
  
  .hero-description {
    color: var(--text-secondary);
    max-width: 32rem;
    margin: 0 auto;
    line-height: 1.6;
  }
  
  @media (max-width: 768px) {
    .container-main {
      margin: 1rem;
      border-radius: 12px;
    }
    
    .progress-steps {
      flex-direction: column;
      gap: 0.5rem;
    }
    
    .step-connector {
      display: none;
    }
    
    .hero-title {
      font-size: 2rem;
    }
    
    .grid {
      grid-template-columns: 1fr;
    }
    
    .feature-card {
      margin-bottom: 1rem;
    }
  }
</style>
{% endblock %}

{% block content %}
<section class="min-h-screen py-8 px-4">
  <div class="max-w-4xl mx-auto">
    
    <!-- Header -->
    <div class="hero-section">
      <div class="hero-icon">
        <i class="fas fa-user-tie text-white text-2xl"></i>
      </div>
      
      <h1 class="hero-title">
        Mock Interview Setup
      </h1>
      
      <p class="hero-description">
        Configure your personalized interview experience. Upload your resume or manually enter your details to receive targeted questions that match your background.
      </p>
    </div>

    <!-- Progress Indicator -->
    <div class="mb-8">
      <div class="flex items-center justify-between max-w-2xl mx-auto">
        <div class="progress-step active">
          <div class="step-circle">1</div>
          <div class="step-label">Setup</div>
        </div>
        <div class="step-connector"></div>
        <div class="progress-step">
          <div class="step-circle">2</div>
          <div class="step-label">Interview</div>
        </div>
        <div class="step-connector"></div>
        <div class="progress-step">
          <div class="step-circle">3</div>
          <div class="step-label">Review</div>
        </div>
      </div>
    </div>

    <!-- Messages -->
    {% if messages %}
      <div class="mb-6">
        {% for message in messages %}
          <div class="message-alert {% if message.tags == 'error' %}error{% elif message.tags == 'success' %}success{% else %}info{% endif %}">
            <div class="flex-shrink-0 mr-3">
              {% if message.tags == 'error' %}
                <i class="fas fa-exclamation-circle"></i>
              {% elif message.tags == 'success' %}
                <i class="fas fa-check-circle"></i>
              {% else %}
                <i class="fas fa-info-circle"></i>
              {% endif %}
            </div>
            <div>{{ message }}</div>
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <!-- Main Form -->
    <div class="container-main p-8">
      <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}

        <!-- Resume Upload Section -->
        <div class="form-group">
          <label class="form-label">
            <div class="icon-container">
              <i class="fas fa-file-upload text-white text-sm"></i>
            </div>
            Resume Upload
            <span class="optional-badge">Optional</span>
          </label>
          
          <div class="upload-area" id="upload-area">
            {{ form.resume_file }}
            <div class="upload-content">
              <i class="fas fa-cloud-upload-alt text-slate-400 text-3xl mb-3"></i>
              <p class="text-slate-300 font-medium mb-1">Drop your resume here or click to browse</p>
              <p class="text-slate-400 text-sm">Supports PDF, DOC, DOCX files up to 10MB</p>
            </div>
          </div>
        </div>

        <!-- Job Role Section -->
        <div class="form-group">
          <label class="form-label">
            <div class="icon-container">
              <i class="fas fa-briefcase text-white text-sm"></i>
            </div>
            Target Position
          </label>
          
          {{ form.job_role }}
          
          <!-- Popular Roles -->
          <div class="mt-3">
            <p class="text-sm text-slate-400 mb-2">Popular positions:</p>
            <div class="flex flex-wrap">
              <button type="button" class="skill-tag" onclick="fillJobRole('Software Engineer')">Software Engineer</button>
              <button type="button" class="skill-tag" onclick="fillJobRole('Data Scientist')">Data Scientist</button>
              <button type="button" class="skill-tag" onclick="fillJobRole('Product Manager')">Product Manager</button>
              <button type="button" class="skill-tag" onclick="fillJobRole('Business Analyst')">Business Analyst</button>
              <button type="button" class="skill-tag" onclick="fillJobRole('DevOps Engineer')">DevOps Engineer</button>
              <button type="button" class="skill-tag" onclick="fillJobRole('UX/UI Designer')">UX/UI Designer</button>
            </div>
          </div>
        </div>

        <!-- Skills Section -->
        <div class="form-group">
          <label class="form-label">
            <div class="icon-container">
              <i class="fas fa-code text-white text-sm"></i>
            </div>
            Key Skills & Technologies
          </label>
          
          {{ form.key_skills }}
          
          <div class="mt-3 tips-box">
            <div class="flex items-start">
              <i class="fas fa-lightbulb text-blue-400 mr-2 mt-0.5"></i>
              <div>
                <p class="tips-title">Tips for better results:</p>
                <ul class="text-sm mt-1 space-y-1">
                  <li>• List relevant programming languages, frameworks, and tools</li>
                  <li>• Include both technical and soft skills</li>
                  <li>• Separate each skill with a comma</li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <!-- Experience Level -->
        <div class="form-group">
          <label class="form-label">
            <div class="icon-container">
              <i class="fas fa-chart-line text-white text-sm"></i>
            </div>
            Experience Level
          </label>
          
          <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
            <label class="radio-option">
              <input type="radio" name="experience_level" value="entry" class="mr-3">
              <span class="text-sm font-medium text-slate-300">Entry Level</span>
            </label>
            <label class="radio-option">
              <input type="radio" name="experience_level" value="mid" class="mr-3" checked>
              <span class="text-sm font-medium text-slate-300">Mid Level</span>
            </label>
            <label class="radio-option">
              <input type="radio" name="experience_level" value="senior" class="mr-3">
              <span class="text-sm font-medium text-slate-300">Senior</span>
            </label>
            <label class="radio-option">
              <input type="radio" name="experience_level" value="lead" class="mr-3">
              <span class="text-sm font-medium text-slate-300">Lead</span>
            </label>
          </div>
        </div>

        <!-- Security & Submit -->
        <div class="flex flex-col sm:flex-row items-center justify-between pt-6 border-t border-slate-700/50">
          <div class="security-badge mb-4 sm:mb-0">
            <i class="fas fa-shield-alt"></i>
            <span>Your data is secure and confidential</span>
          </div>
          
          <button type="submit" class="btn-primary flex items-center">
            <i class="fas fa-arrow-right mr-2"></i>
            <span>Begin Interview</span>
          </button>
        </div>
      </form>
    </div>

    <!-- Features Section -->
    <div class="mt-12">
      <h3 class="text-xl font-bold text-center text-slate-200 mb-8">What to Expect</h3>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="feature-card">
          <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-brain text-white text-xl"></i>
          </div>
          <h4 class="font-semibold text-slate-200 mb-2">AI-Powered Questions</h4>
          <p class="text-slate-400 text-sm">Intelligent questions tailored to your role and experience level</p>
        </div>
        
        <div class="feature-card">
          <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-green-600 rounded-lg flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-microphone text-white text-xl"></i>
          </div>
          <h4 class="font-semibold text-slate-200 mb-2">Voice Interaction</h4>
          <p class="text-slate-400 text-sm">Practice speaking naturally with real-time speech recognition</p>
        </div>
        
        <div class="feature-card">
          <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-chart-bar text-white text-xl"></i>
          </div>
          <h4 class="font-semibold text-slate-200 mb-2">Detailed Analysis</h4>
          <p class="text-slate-400 text-sm">Comprehensive feedback on communication and technical responses</p>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
function fillJobRole(role) {
  const input = document.querySelector('input[name="job_role"]');
  input.value = role;
  input.focus();
  
  // Visual feedback
  input.style.borderColor = '#3b82f6';
  setTimeout(() => {
    input.style.borderColor = 'rgba(148, 163, 184, 0.2)';
  }, 1000);
}

// Enhanced file upload handling
document.addEventListener('DOMContentLoaded', function() {
  const fileInput = document.querySelector('input[type="file"]');
  const uploadArea = document.getElementById('upload-area');
  const uploadContent = uploadArea.querySelector('.upload-content');
  
  if (fileInput && uploadArea) {
    fileInput.style.display = 'none';
    
    fileInput.addEventListener('change', function(e) {
      handleFileSelect(e.target.files[0]);
    });
    
    uploadArea.addEventListener('click', function(e) {
      if (e.target !== fileInput) {
        fileInput.click();
      }
    });
    
    // Drag and drop
    uploadArea.addEventListener('dragover', function(e) {
      e.preventDefault();
      uploadArea.style.borderColor = '#3b82f6';
      uploadArea.style.background = 'rgba(59, 130, 246, 0.05)';
    });
    
    uploadArea.addEventListener('dragleave', function(e) {
      uploadArea.style.borderColor = 'rgba(148, 163, 184, 0.2)';
      uploadArea.style.background = 'rgba(255, 255, 255, 0.03)';
    });
    
    uploadArea.addEventListener('drop', function(e) {
      e.preventDefault();
      uploadArea.style.borderColor = 'rgba(148, 163, 184, 0.2)';
      uploadArea.style.background = 'rgba(255, 255, 255, 0.03)';
      
      if (e.dataTransfer.files.length > 0) {
        fileInput.files = e.dataTransfer.files;
        handleFileSelect(e.dataTransfer.files[0]);
      }
    });
  }
  
  function handleFileSelect(file) {
    if (file) {
      uploadArea.classList.add('has-file');
      uploadContent.innerHTML = `
        <i class="fas fa-file-alt text-green-400 text-3xl mb-3"></i>
        <p class="text-green-300 font-medium mb-1">${file.name}</p>
        <p class="text-green-400 text-sm">${(file.size / 1024 / 1024).toFixed(1)} MB</p>
      `;
    }
  }
  
  // Style form inputs
  const inputs = document.querySelectorAll('input:not([type="file"]):not([type="radio"]), textarea, select');
  inputs.forEach(input => {
    input.classList.add('form-input');
  });
  
  // Style radio buttons for better UX
  const radioInputs = document.querySelectorAll('input[type="radio"]');
  radioInputs.forEach(radio => {
    radio.addEventListener('change', function() {
      // Remove active class from all labels
      document.querySelectorAll('.radio-option').forEach(label => {
        label.classList.remove('active');
      });
      
      // Add active class to selected label
      if (this.checked) {
        this.closest('.radio-option').classList.add('active');
      }
    });
  });
  
  // Set initial active state for checked radio
  const checkedRadio = document.querySelector('input[type="radio"]:checked');
  if (checkedRadio) {
    checkedRadio.closest('.radio-option').classList.add('active');
  }
  
  // Enhanced form validation feedback
  const form = document.querySelector('form');
  if (form) {
    form.addEventListener('submit', function(e) {
      const jobRoleInput = document.querySelector('input[name="job_role"]');
      const skillsInput = document.querySelector('textarea[name="key_skills"]');
      
      if (!jobRoleInput.value.trim()) {
        e.preventDefault();
        jobRoleInput.style.borderColor = '#ef4444';
        jobRoleInput.focus();
        
        // Show error message
        showNotification('Please enter a target position', 'error');
        return;
      }
      
      if (!skillsInput.value.trim()) {
        e.preventDefault();
        skillsInput.style.borderColor = '#ef4444';
        skillsInput.focus();
        
        // Show error message
        showNotification('Please enter your key skills', 'error');
        return;
      }
      
      // Show success message
      showNotification('Setting up your interview...', 'info');
    });
  }
  
  // Simple notification system
  function showNotification(message, type) {
    const notification = document.createElement('div');
    notification.className = `message-alert ${type}`;
    notification.innerHTML = `
      <div class="flex-shrink-0 mr-3">
        <i class="fas fa-${type === 'error' ? 'exclamation-circle' : type === 'success' ? 'check-circle' : 'info-circle'}"></i>
      </div>
      <div>${message}</div>
    `;
    
    // Insert at top of form
    const form = document.querySelector('form');
    form.insertBefore(notification, form.firstChild);
    
    // Remove after 5 seconds
    setTimeout(() => {
      notification.remove();
    }, 5000);
  }
});
</script>
{% endblock %}