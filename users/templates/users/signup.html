{% extends 'base.html' %}
{% load form_filters %}

{% block title %}Sign Up | MockMate{% endblock %}

{% block content %}
<section class="min-h-screen py-8 px-4 flex items-center justify-center">
  <div class="relative max-w-md w-full mx-auto">
    <!-- Main card -->
    <div class="glass-elevated p-8 rounded-xl border border-slate-700/50 bg-slate-900/90 backdrop-blur-xl">
      
      <!-- Header -->
      <div class="text-center mb-8">
        <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-blue-500 via-purple-500 to-indigo-500 rounded-full mb-4 shadow-lg">
          <i class="ri-user-add-line text-white text-2xl"></i>
        </div>
        <h2 class="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-purple-400 to-indigo-400 mb-2">
          Join MockMate
        </h2>
        <p class="text-slate-400 text-sm font-medium">Start your interview prep journey today</p>
      </div>

      <form method="post" class="space-y-6">
        {% csrf_token %}

        <!-- Error display -->
        {% if form.errors %}
          <div class="glass border-l-4 border-red-500 bg-red-500/10 text-red-300 px-4 py-3 rounded-r-lg border border-red-500/30">
            <div class="flex items-start">
              <i class="ri-error-warning-line text-red-400 mt-0.5 mr-3"></i>
              <div>
                <strong class="font-semibold text-red-300">Please fix these issues:</strong>
                <ul class="text-sm mt-2 space-y-1 text-red-200">
                  {% for field, errors in form.errors.items %}
                    {% for error in errors %}
                      <li><strong class="text-red-300">{{ field }}:</strong> {{ error }}</li>
                    {% endfor %}
                  {% endfor %}
                </ul>
              </div>
            </div>
          </div>
        {% endif %}

        <!-- Username field -->
        <div class="form-group">
          <label class="block text-sm font-semibold text-slate-300 mb-2 flex items-center gap-2">
            <i class="ri-user-line text-blue-400"></i>
            Username
          </label>
          <div class="relative">
            {{ form.username|add_class:"w-full px-4 py-3 pl-11 border border-slate-600 bg-slate-800 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all text-slate-200 font-medium placeholder:text-slate-500" }}
            <i class="ri-at-line absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-500"></i>
          </div>
          {% if form.username.errors %}
            <p class="mt-2 text-sm text-red-400 flex items-center font-medium">
              <i class="ri-error-warning-line mr-1"></i>
              {{ form.username.errors.0 }}
            </p>
          {% endif %}
        </div>

        <!-- Email field -->
        <div class="form-group">
          <label class="block text-sm font-semibold text-slate-300 mb-2 flex items-center gap-2">
            <i class="ri-mail-line text-purple-400"></i>
            Email Address
          </label>
          <div class="relative">
            {{ form.email|add_class:"w-full px-4 py-3 pl-11 border border-slate-600 bg-slate-800 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all text-slate-200 font-medium placeholder:text-slate-500" }}
            <i class="ri-mail-send-line absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-500"></i>
          </div>
          {% if form.email.errors %}
            <p class="mt-2 text-sm text-red-400 flex items-center font-medium">
              <i class="ri-error-warning-line mr-1"></i>
              {{ form.email.errors.0 }}
            </p>
          {% endif %}
        </div>

        <!-- Role selection -->
        <div class="form-group">
          <label class="block text-sm font-semibold text-slate-300 mb-3 flex items-center gap-2">
            <i class="ri-group-line text-emerald-400"></i>
            I am a:
          </label>
          <div class="space-y-3">
            {% for radio in form.role %}
              <div class="relative">
                <label for="{{ radio.id_for_label }}" class="flex items-center p-3 border border-slate-600 bg-slate-800/50 rounded-lg cursor-pointer hover:border-slate-500 hover:bg-slate-800/70 transition-all group">
                  {{ radio.tag }}
                  <div class="flex items-center justify-center w-5 h-5 border border-slate-500 rounded-full mr-3 group-hover:border-emerald-400 transition-colors">
                    <div class="w-3 h-3 bg-emerald-400 rounded-full opacity-0 scale-0 transition-all"></div>
                  </div>
                  <div class="flex flex-col">
                    <span class="text-slate-200 font-medium group-hover:text-emerald-200 transition-colors">{{ radio.choice_label }}</span>
                    <span class="text-xs text-slate-500 mt-1">
                      {% if radio.choice_label == 'Student' %}
                        Practice coding problems and take mock interviews
                      {% elif radio.choice_label == 'Tutor' %}
                        Help students and create educational content
                      {% endif %}
                    </span>
                  </div>
                  <i class="ri-check-line text-emerald-400 ml-auto opacity-0 scale-0 group-hover:opacity-100 group-hover:scale-100 transition-all"></i>
                </label>
              </div>
            {% endfor %}
          </div>
          {% if form.role.errors %}
            <p class="mt-2 text-sm text-red-400 flex items-center font-medium">
              <i class="ri-error-warning-line mr-1"></i>
              {{ form.role.errors.0 }}
            </p>
          {% endif %}
        </div>

        <!-- Password field -->
        <div class="form-group">
          <label class="block text-sm font-semibold text-slate-300 mb-2 flex items-center gap-2">
            <i class="ri-lock-line text-orange-400"></i>
            Password
          </label>
          <div class="relative">
            {{ form.password1|add_class:"w-full px-4 py-3 pl-11 pr-11 border border-slate-600 bg-slate-800 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all text-slate-200 font-medium placeholder:text-slate-500" }}
            <i class="ri-key-line absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-500"></i>
            <button type="button" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-500 hover:text-orange-400 transition-colors" onclick="togglePassword(this, 'password1')">
              <i class="ri-eye-line"></i>
            </button>
          </div>
          {% if form.password1.errors %}
            <p class="mt-2 text-sm text-red-400 flex items-center font-medium">
              <i class="ri-error-warning-line mr-1"></i>
              {{ form.password1.errors.0 }}
            </p>
          {% endif %}
          
          <!-- Password strength indicator -->
          <div class="mt-2">
            <div class="text-xs text-slate-500 mb-1">Password strength:</div>
            <div class="flex space-x-1">
              <div id="strength-1" class="h-1 w-1/4 bg-slate-700 rounded transition-colors"></div>
              <div id="strength-2" class="h-1 w-1/4 bg-slate-700 rounded transition-colors"></div>
              <div id="strength-3" class="h-1 w-1/4 bg-slate-700 rounded transition-colors"></div>
              <div id="strength-4" class="h-1 w-1/4 bg-slate-700 rounded transition-colors"></div>
            </div>
          </div>
        </div>

        <!-- Confirm password field -->
        <div class="form-group">
          <label class="block text-sm font-semibold text-slate-300 mb-2 flex items-center gap-2">
            <i class="ri-shield-check-line text-green-400"></i>
            Confirm Password
          </label>
          <div class="relative">
            {{ form.password2|add_class:"w-full px-4 py-3 pl-11 pr-11 border border-slate-600 bg-slate-800 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all text-slate-200 font-medium placeholder:text-slate-500" }}
            <i class="ri-check-double-line absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-500"></i>
            <button type="button" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-500 hover:text-green-400 transition-colors" onclick="togglePassword(this, 'password2')">
              <i class="ri-eye-line"></i>
            </button>
          </div>
          {% if form.password2.errors %}
            <p class="mt-2 text-sm text-red-400 flex items-center font-medium">
              <i class="ri-error-warning-line mr-1"></i>
              {{ form.password2.errors.0 }}
            </p>
          {% endif %}
        </div>

        <!-- Submit button -->
        <button type="submit" class="w-full px-6 py-3 bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-600 text-white rounded-lg font-semibold text-lg hover:from-blue-700 hover:via-purple-700 hover:to-indigo-700 transform hover:scale-[1.02] transition-all shadow-lg hover:shadow-xl flex items-center justify-center gap-2">
          <span class="signup-text">Create Account</span>
          <i class="ri-arrow-right-line"></i>
        </button>
      </form>

      <!-- Login link -->
      <div class="mt-6 text-center">
        <p class="text-slate-400 mb-3 font-medium">Already have an account?</p>
        <a href="{% url 'login' %}" class="inline-flex items-center px-4 py-2 border border-slate-600 bg-slate-800/50 text-slate-300 rounded-lg font-medium hover:bg-slate-800/70 hover:border-slate-500 hover:text-slate-200 transition-all">
          <i class="ri-login-box-line mr-2"></i>
          Sign In
        </a>
      </div>
      
      <!-- Terms -->
      <div class="mt-4 text-center">
        <p class="text-xs text-slate-500">
          By creating an account, you agree to our 
          <a href="#" class="text-blue-400 hover:text-blue-300 underline">Terms of Service</a> 
          and 
          <a href="#" class="text-blue-400 hover:text-blue-300 underline">Privacy Policy</a>
        </p>
      </div>
    </div>
  </div>
</section>

<style>
/* Custom radio button styling */
input[type="radio"] {
  appearance: none;
  width: 20px;
  height: 20px;
  border: 2px solid #64748b;
  border-radius: 50%;
  background-color: transparent;
  margin-right: 12px;
  position: relative;
  cursor: pointer;
  transition: all 0.2s ease;
}

input[type="radio"]:checked {
  border-color: #10b981;
  background-color: #10b981;
}

input[type="radio"]:checked::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background-color: white;
  transform: translate(-50%, -50%);
}

input[type="radio"]:checked + div .w-3 {
  opacity: 1 !important;
  transform: scale(1) !important;
}

input[type="radio"]:checked + div .ri-check-line {
  opacity: 1 !important;
  transform: scale(1) !important;
}

input[type="radio"]:checked + label,
input[type="radio"]:checked ~ * {
  border-color: #10b981 !important;
  background-color: rgba(16, 185, 129, 0.1) !important;
}

/* Password strength colors */
.strength-weak { background-color: #ef4444 !important; }
.strength-fair { background-color: #f97316 !important; }
.strength-good { background-color: #eab308 !important; }
.strength-strong { background-color: #22c55e !important; }

/* Loading state */
button[type="submit"]:disabled {
  opacity: 0.7;
  cursor: not-allowed;
  transform: none !important;
}
</style>

<script>
function togglePassword(button, fieldName) {
  const field = document.querySelector(`input[name="${fieldName}"]`);
  const icon = button.querySelector('i');
  
  if (field.type === 'password') {
    field.type = 'text';
    icon.classList.remove('ri-eye-line');
    icon.classList.add('ri-eye-off-line');
  } else {
    field.type = 'password';
    icon.classList.remove('ri-eye-off-line');
    icon.classList.add('ri-eye-line');
  }
}

// Password strength checker
function checkPasswordStrength(password) {
  let strength = 0;
  
  if (password.length >= 8) strength++;
  if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
  if (/\d/.test(password)) strength++;
  if (/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password)) strength++;
  
  return strength;
}

function updatePasswordStrength(strength) {
  const indicators = ['strength-1', 'strength-2', 'strength-3', 'strength-4'];
  
  indicators.forEach((id, index) => {
    const element = document.getElementById(id);
    if (element) {
      element.className = element.className.replace(/strength-\w+/g, '');
      
      if (index < strength) {
        if (strength === 1) element.classList.add('strength-weak');
        else if (strength === 2) element.classList.add('strength-fair');
        else if (strength === 3) element.classList.add('strength-good');
        else if (strength === 4) element.classList.add('strength-strong');
      } else {
        element.classList.add('bg-slate-700');
      }
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  // Password strength monitoring
  const passwordField = document.querySelector('input[name="password1"]');
  if (passwordField) {
    passwordField.addEventListener('input', function() {
      const strength = checkPasswordStrength(this.value);
      updatePasswordStrength(strength);
    });
  }
  
  // Form submission handling
  const form = document.querySelector('form');
  if (form) {
    form.addEventListener('submit', function(e) {
      const submitBtn = form.querySelector('button[type="submit"]');
      if (submitBtn) {
        submitBtn.disabled = true;
        const btnText = submitBtn.querySelector('.signup-text');
        if (btnText) {
          btnText.textContent = 'Creating Account...';
          
          setTimeout(() => {
            submitBtn.disabled = false;
            btnText.textContent = 'Create Account';
          }, 10000);
        }
      }
    });
  }
  
  // Role selection enhancement
  const roleInputs = document.querySelectorAll('input[name="role"]');
  roleInputs.forEach(input => {
    input.addEventListener('change', function() {
      roleInputs.forEach(radio => {
        const label = radio.closest('label');
        if (label) {
          label.classList.remove('border-emerald-500', 'bg-emerald-500/10');
          label.classList.add('border-slate-600');
        }
      });
      
      if (this.checked) {
        const label = this.closest('label');
        if (label) {
          label.classList.remove('border-slate-600');
          label.classList.add('border-emerald-500', 'bg-emerald-500/10');
        }
      }
    });
  });
});
</script>
{% endblock %}