{% extends 'base.html' %}
{% load form_filters %} {# This line is crucial for add_class filter #}

{% block title %}Sign Up | MockMate{% endblock %}

{% block content %}
<section class="min-h-screen py-12 px-4 bg-gradient-to-br from-purple-50 via-blue-50 to-indigo-100 relative overflow-hidden">
  <!-- Animated background elements -->
  <div class="absolute inset-0 overflow-hidden">
    <div class="absolute -top-40 -right-40 w-80 h-80 bg-gradient-to-br from-blue-200 to-purple-200 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-pulse"></div>
    <div class="absolute -bottom-40 -left-40 w-80 h-80 bg-gradient-to-br from-pink-200 to-yellow-200 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-pulse animation-delay-2000"></div>
    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-60 h-60 bg-gradient-to-br from-green-200 to-blue-200 rounded-full mix-blend-multiply filter blur-xl opacity-50 animate-pulse animation-delay-4000"></div>
  </div>

  <div class="relative max-w-md mx-auto">
    <!-- Main card with enhanced styling -->
    <div class="bg-white/90 backdrop-blur-lg p-8 rounded-3xl shadow-2xl border border-white/20 transform hover:scale-[1.02] transition-all duration-300">
      
      <!-- Header with gradient text and icon -->
      <div class="text-center mb-8">
        <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full mb-4 transform hover:rotate-12 transition-transform duration-300">
          <i class="fas fa-rocket text-white text-2xl"></i>
        </div>
        <h2 class="text-3xl font-bold bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-600 bg-clip-text text-transparent mb-2">
          Join MockMate
        </h2>
        <p class="text-gray-600 text-sm">Start your interview prep journey today! ðŸŽ¯</p>
      </div>

      <form method="post" class="space-y-6">
        {% csrf_token %}

        {# Enhanced error block with better styling #}
        {% if form.errors %}
          <div class="bg-gradient-to-r from-red-50 to-pink-50 border-l-4 border-red-400 text-red-700 px-6 py-4 rounded-r-xl shadow-sm animate-shake">
            <div class="flex items-start">
              <i class="fas fa-exclamation-triangle text-red-400 mt-0.5 mr-3"></i>
              <div>
                <strong class="font-semibold">Oops! Please fix these issues:</strong>
                <ul class="text-sm list-disc ml-5 mt-2 space-y-1">
                  {% for field, errors in form.errors.items %}
                    {% for error in errors %}
                      <li><strong>{{ field }}:</strong> {{ error }}</li>
                    {% endfor %}
                  {% endfor %}
                </ul>
              </div>
            </div>
          </div>
        {% endif %}

        <!-- Username field with icon -->
        <div class="group">
          <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
            <i class="fas fa-user text-blue-500 mr-2"></i>
            Username
          </label>
          <div class="relative">
            {{ form.username|add_class:"w-full px-4 py-4 pl-12 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300 group-hover:border-blue-300 bg-gray-50 focus:bg-white" }}
            <i class="fas fa-at absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 group-focus-within:text-blue-500 transition-colors"></i>
          </div>
          {% if form.username.errors %}
            <p class="mt-2 text-sm text-red-600 flex items-center">
              <i class="fas fa-exclamation-circle mr-1"></i>
              {{ form.username.errors }}
            </p>
          {% endif %}
        </div>

        <!-- Email field with icon -->
        <div class="group">
          <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
            <i class="fas fa-envelope text-purple-500 mr-2"></i>
            Email Address
          </label>
          <div class="relative">
            {{ form.email|add_class:"w-full px-4 py-4 pl-12 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-300 group-hover:border-purple-300 bg-gray-50 focus:bg-white" }}
            <i class="fas fa-paper-plane absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 group-focus-within:text-purple-500 transition-colors"></i>
          </div>
          {% if form.email.errors %}
            <p class="mt-2 text-sm text-red-600 flex items-center">
              <i class="fas fa-exclamation-circle mr-1"></i>
              {{ form.email.errors }}
            </p>
          {% endif %}
        </div>

        <!-- Role selection with enhanced styling -->
        <div class="group">
          <label class="block text-sm font-semibold text-gray-700 mb-3 flex items-center">
            <i class="fas fa-users text-indigo-500 mr-2"></i>
            I am a:
          </label>
          <div class="grid grid-cols-1 gap-3">
            {% for radio in form.role %}
              <div class="relative">
                <label for="{{ radio.id_for_label }}" class="flex items-center p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-indigo-300 hover:bg-indigo-50 transition-all duration-300 group">
                  {{ radio.tag }}
                  <div class="flex items-center justify-center w-5 h-5 border-2 border-gray-300 rounded-full mr-3 group-hover:border-indigo-500 transition-colors">
                    <div class="w-3 h-3 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full opacity-0 group-hover:opacity-100 transition-opacity"></div>
                  </div>
                  <span class="text-gray-700 font-medium group-hover:text-indigo-700 transition-colors">{{ radio.choice_label }}</span>
                  <i class="fas fa-check-circle text-green-500 ml-auto opacity-0 group-hover:opacity-100 transition-all duration-300 transform scale-0 group-hover:scale-100"></i>
                </label>
              </div>
            {% endfor %}
          </div>
          {% if form.role.errors %}
            <p class="mt-2 text-sm text-red-600 flex items-center">
              <i class="fas fa-exclamation-circle mr-1"></i>
              {{ form.role.errors }}
            </p>
          {% endif %}
        </div>

        <!-- Password field with strength indicator -->
        <div class="group">
          <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
            <i class="fas fa-lock text-green-500 mr-2"></i>
            Password
          </label>
          <div class="relative">
            {{ form.password1|add_class:"w-full px-4 py-4 pl-12 pr-12 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-300 group-hover:border-green-300 bg-gray-50 focus:bg-white" }}
            <i class="fas fa-key absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 group-focus-within:text-green-500 transition-colors"></i>
            <button type="button" class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-green-500 transition-colors" onclick="togglePassword(this, 'password1')">
              <i class="fas fa-eye"></i>
            </button>
          </div>
          {% if form.password1.errors %}
            <p class="mt-2 text-sm text-red-600 flex items-center">
              <i class="fas fa-exclamation-circle mr-1"></i>
              {{ form.password1.errors }}
            </p>
          {% endif %}
        </div>

        <!-- Confirm password field -->
        <div class="group">
          <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
            <i class="fas fa-shield-alt text-orange-500 mr-2"></i>
            Confirm Password
          </label>
          <div class="relative">
            {{ form.password2|add_class:"w-full px-4 py-4 pl-12 pr-12 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all duration-300 group-hover:border-orange-300 bg-gray-50 focus:bg-white" }}
            <i class="fas fa-check-double absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 group-focus-within:text-orange-500 transition-colors"></i>
            <button type="button" class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-orange-500 transition-colors" onclick="togglePassword(this, 'password2')">
              <i class="fas fa-eye"></i>
            </button>
          </div>
          {% if form.password2.errors %}
            <p class="mt-2 text-sm text-red-600 flex items-center">
              <i class="fas fa-exclamation-circle mr-1"></i>
              {{ form.password2.errors }}
            </p>
          {% endif %}
        </div>

        <!-- Enhanced submit button -->
        <button type="submit" class="group w-full px-8 py-4 bg-gradient-to-r from-blue-500 via-purple-500 to-indigo-600 text-white rounded-xl font-bold text-lg hover:from-blue-600 hover:via-purple-600 hover:to-indigo-700 transform hover:scale-105 hover:-translate-y-1 transition-all duration-300 shadow-lg hover:shadow-2xl flex items-center justify-center relative overflow-hidden">
          <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent -skew-x-12 -translate-x-full group-hover:translate-x-full transition-transform duration-1000"></div>
          <span class="relative flex items-center">
            Create Account
            <i class="fas fa-rocket ml-2 group-hover:translate-x-1 transition-transform duration-300"></i>
          </span>
        </button>
      </form>

      <!-- Enhanced login link -->
      <div class="mt-8 text-center">
        <p class="text-gray-600 mb-3">Already part of the MockMate family?</p>
        <a href="{% url 'login' %}" class="inline-flex items-center px-6 py-3 border-2 border-blue-200 text-blue-600 rounded-xl font-semibold hover:bg-blue-50 hover:border-blue-300 transform hover:scale-105 transition-all duration-300 group">
          <i class="fas fa-sign-in-alt mr-2 group-hover:translate-x-1 transition-transform"></i>
          Login Here
        </a>
      </div>
    </div>

    <!-- Fun floating elements -->
    <div class="absolute -top-6 -right-6 w-12 h-12 bg-gradient-to-br from-yellow-300 to-orange-400 rounded-full animate-bounce opacity-80"></div>
    <div class="absolute -bottom-6 -left-6 w-8 h-8 bg-gradient-to-br from-pink-300 to-red-400 rounded-full animate-pulse opacity-80"></div>
  </div>
</section>

<script>
function togglePassword(button, fieldName) {
  const field = document.querySelector(`input[name="${fieldName}"]`);
  const icon = button.querySelector('i');
  
  if (field.type === 'password') {
    field.type = 'text';
    icon.classList.remove('fa-eye');
    icon.classList.add('fa-eye-slash');
  } else {
    field.type = 'password';
    icon.classList.remove('fa-eye-slash');
    icon.classList.add('fa-eye');
  }
}
</script>

<style>
@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-5px); }
  75% { transform: translateX(5px); }
}

.animate-shake {
  animation: shake 0.5s ease-in-out;
}

.animation-delay-2000 {
  animation-delay: 2s;
}

.animation-delay-4000 {
  animation-delay: 4s;
}

/* Custom radio button styling */
input[type="radio"]:checked + div {
  border-color: #6366f1 !important;
  background-color: #eef2ff !important;
}

input[type="radio"]:checked + div .w-3 {
  opacity: 1 !important;
  transform: scale(1) !important;
}

input[type="radio"]:checked + div .fa-check-circle {
  opacity: 1 !important;
  transform: scale(1) !important;
}

/* Focus states for better accessibility */
input:focus + .fas,
input:focus-within + .fas {
  transform: translateY(-50%) scale(1.1);
}
</style>
{% endblock %}