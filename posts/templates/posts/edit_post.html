{% extends "base.html" %}
{% load static %}

{% block title %}Edit Post - MockMate{% endblock %}

{% block content %}
<div class="min-h-screen py-8 px-4 sm:px-6 lg:px-8">
  <div class="max-w-3xl mx-auto">

    <!-- Back Navigation -->
    <div class="mb-8">
      <a href="javascript:history.back()" 
         class="flex items-center text-cyan-400 hover:text-cyan-300 font-medium transition-colors group">
        <i class="ri-arrow-left-line text-xl mr-2 group-hover:-translate-x-1 transition-transform"></i>
        <span>Back</span>
      </a>
    </div>

    <!-- Main Form Container -->
    <div class="bg-white/5 backdrop-blur-xl border border-white/10 rounded-3xl shadow-2xl overflow-hidden">
      
      <!-- Form Header -->
      <div class="bg-gradient-to-r from-cyan-600/20 to-blue-600/20 p-6 sm:p-8 border-b border-white/10">
        <div class="flex items-center">
          {% if user.profile.avatar %}
            <img src="{{ user.profile.avatar.url }}" alt="{{ user.username }}"
                 class="w-14 h-14 rounded-full object-cover mr-5 ring-2 ring-cyan-400/50">
          {% else %}
            <div class="w-14 h-14 rounded-full mr-5 ring-2 ring-cyan-400/50 bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center text-white font-bold text-xl">
              {{ user.username|first|upper }}
            </div>
          {% endif %}
          <div>
            <h1 class="text-2xl font-bold text-gray-100">Edit Post</h1>
            <p class="text-gray-400">Make changes to your shared post.</p>
          </div>
        </div>
      </div>

      <!-- Form Content -->
      <div class="p-6 sm:p-8">
        <form method="post" enctype="multipart/form-data" id="edit-form" class="space-y-6">
          {% csrf_token %}

          <!-- Content Field -->
          <div>
            <label for="{{ form.content.id_for_label }}" 
                   class="block text-sm font-medium text-gray-300 mb-2">
              Your Message
            </label>
            <textarea name="content" 
                      id="{{ form.content.id_for_label }}"
                      rows="6" 
                      required
                      class="w-full bg-black/20 backdrop-blur-sm border border-white/10 rounded-xl px-4 py-3 text-gray-200 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500 transition-all duration-300 resize-none"
                      placeholder="What's on your mind?">{{ form.content.value|default_if_none:"" }}</textarea>
            {% if form.content.errors %}
              <p class="text-red-400 text-sm mt-2">{{ form.content.errors.0 }}</p>
            {% endif %}
          </div>

          <!-- Image Field -->
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">
              Image
            </label>
            
            <div class="flex flex-col gap-4">
              <!-- Current Image Display -->
              {% if form.instance.image %}
                <div class="relative w-fit">
                  <p class="text-xs text-gray-400 mb-2">Current image:</p>
                  <img src="{{ form.instance.image.url }}" 
                       alt="Current image" 
                       class="max-h-60 rounded-lg shadow-lg border border-white/10">
                </div>
              {% endif %}

              <!-- Image Upload -->
              <div class="relative">
                <label for="{{ form.image.id_for_label }}" 
                       class="flex flex-col items-center justify-center w-full border-2 border-dashed border-white/20 rounded-xl p-6 cursor-pointer hover:border-cyan-400 hover:bg-cyan-500/10 transition-all duration-300 group">
                  <i class="ri-upload-cloud-2-line text-4xl text-gray-400 group-hover:text-cyan-400 transition-colors"></i>
                  <p class="text-gray-400 group-hover:text-gray-200 mt-2 text-sm font-semibold">
                    {% if form.instance.image %}Change image{% else %}Upload an image{% endif %}
                  </p>
                </label>
                <input type="file" 
                       name="image" 
                       id="{{ form.image.id_for_label }}"
                       accept="image/*" 
                       class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
              </div>

              <!-- Image Preview -->
              <div id="image-preview" class="hidden relative w-fit">
                 <p class="text-xs text-gray-400 mb-2">New image preview:</p>
                 <img id="preview-img" class="max-h-60 rounded-lg shadow-lg border border-white/10">
              </div>
            </div>
            
            {% if form.image.errors %}
              <p class="text-red-400 text-sm mt-2">{{ form.image.errors.0 }}</p>
            {% endif %}
          </div>

          <!-- Action Buttons -->
          <div class="flex items-center justify-end gap-4 pt-6 border-t border-white/10">
            <a href="javascript:history.back()" 
               class="px-5 py-2 text-gray-300 hover:bg-white/10 font-medium rounded-full transition-colors text-sm">
              Cancel
            </a>
            <button type="submit"
                    class="px-6 py-2.5 bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white font-bold rounded-full shadow-lg hover:shadow-cyan-500/50 transform hover:scale-105 transition-all duration-300 text-sm flex items-center gap-2">
              <i class="ri-check-line text-lg"></i>
              Update Post
            </button>
          </div>

        </form>
      </div>
    </div>
  </div>
</div>

<!-- Loading Overlay -->
<div id="loading-overlay" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 hidden items-center justify-center">
  <div class="flex flex-col items-center gap-4">
    <div class="animate-spin rounded-full h-10 w-10 border-4 border-white/20 border-t-cyan-400"></div>
    <p class="text-gray-200 font-medium">Updating...</p>
  </div>
</div>


<script>
  document.addEventListener('DOMContentLoaded', function() {
    
    // Image preview functionality
    const imageInput = document.getElementById('{{ form.image.id_for_label }}');
    const imagePreviewContainer = document.getElementById('image-preview');
    const previewImg = document.getElementById('preview-img');
    
    if (imageInput && imagePreviewContainer && previewImg) {
      imageInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function(event) {
            previewImg.src = event.target.result;
            imagePreviewContainer.classList.remove('hidden');
          };
          reader.readAsDataURL(file);
        } else {
          imagePreviewContainer.classList.add('hidden');
        }
      });
    }

    // Show loading overlay on form submission
    const form = document.getElementById('edit-form');
    const loadingOverlay = document.getElementById('loading-overlay');
    
    if (form && loadingOverlay) {
      form.addEventListener('submit', function() {
        loadingOverlay.classList.remove('hidden');
        loadingOverlay.classList.add('flex');
      });
    }
  });
</script>
{% endblock %}
